<div class="status-board">
  <!-- テーブル形式でタスクを表示 -->
  <table class="task-table">
    <thead>
      <tr>
        <th class="status-header-cell">ステータス</th>
        <th *ngFor="let priority of getPriorityColumns()">
          タスク{{ priority }}
        </th>
        <th class="actions-header-cell">操作</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let statusColumn of statusColumns" class="status-row">
        <!-- ステータス列のヘッダー -->
        <td class="status-cell">
          <div class="reject-header" *ngIf="statusColumn.isRejectColumn">
            <h3>{{ statusColumn.title }}</h3>
            <label class="switch">
              <input
                type="checkbox"
                [(ngModel)]="statusColumn.isRejectEnabled"
              />
              <span class="slider round"></span>
            </label>
          </div>
          <h3 *ngIf="!statusColumn.isRejectColumn">{{ statusColumn.title }}</h3>
        </td>

        <!-- 各優先度のタスクセル -->
        <td
          *ngFor="let priority of getPriorityColumns()"
          class="task-cell"
          cdkDropList
          [id]="getDropListId(statusColumn.id, priority)"
          [cdkDropListData]="{ statusId: statusColumn.id, priority: priority }"
          [cdkDropListConnectedTo]="getConnectedListIds()"
          (cdkDropListDropped)="drop($event)"
        >
          <div
            *ngIf="getTaskByStatusAndPriority(statusColumn.id, priority) as task"
            class="task-box"
            cdkDrag
            [cdkDragData]="task"
          >
            <ng-container *ngIf="editingTask?.taskId === task.id; else showTask">
              <div [formGroup]="editingTaskForm" class="edit-form">
                <input
                  type="text"
                  formControlName="content"
                  (blur)="saveTask(editingTask.taskId)"
                  (keyup.enter)="saveTask(editingTask.taskId)"
                />
                <input
                  type="number"
                  formControlName="priority"
                  (blur)="saveTask(editingTask.taskId)"
                  (keyup.enter)="saveTask(editingTask.taskId)"
                  min="1"
                />
                <button (click)="cancelEdit()" class="cancel-btn">キャンセル</button>
              </div>
            </ng-container>
            <ng-template #showTask>
              <div class="task-content">{{ task.content }}</div>
              <div class="task-actions">
                <button
                  (click)="editTask(task.id, task.statusId, task.content, task.priority)"
                  class="edit-btn"
                >
                  編集
                </button>
                <button (click)="deleteTask(task.id)" class="delete-btn">
                  削除
                </button>
              </div>
            </ng-template>
          </div>
        </td>

        <!-- タスク追加セル -->
        <td class="add-task-cell">
          <div
            class="add-task"
            *ngIf="!statusColumn.isRejectColumn"
            [formGroup]="newTaskForm"
          >
            <input
              type="text"
              formControlName="content"
              placeholder="タスクを追加"
            />
            <input
              type="number"
              formControlName="priority"
              placeholder="優先度"
              min="1"
            />
            <button
              (click)="addTask(statusColumn)"
              [disabled]="newTaskForm.invalid"
              class="add-btn"
            >
              追加
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- 新しいステータス列を追加するセクション -->
  <div class="add-column-section" [formGroup]="newColumnForm">
    <input
      type="text"
      formControlName="title"
      placeholder="新しいステータスのタイトル"
    />
    <button (click)="addColumn()" [disabled]="newColumnForm.invalid">
      ステータスを追加
    </button>
  </div>
</div>
