<p>home works!</p>

<table>
  <thead>
    <tr>
      <th>Index</th>
      <!--
        【列の追加・削除方法】
        1. ここで `[].constructor(10)` の `10` を変更することで、追加列の数を調整できます。
           例: 5列に減らす場合 `[].constructor(5)`
           例: 15列に増やす場合 `[].constructor(15)`
        2. `home.component.ts` の `ADDED_COLUMNS_COUNT` 定数も同じ値に変更してください。
        3. `home.component.scss` の `th:nth-child()` と `td:nth-child()` セレクタも調整が必要です。
           特に、追加列のCSSセレクタの範囲 (`th:nth-child(2)` から `th:nth-child(11)`) を変更後の列数に合わせて更新してください。
      -->
      <ng-container *ngFor="let col of [].constructor(10); let k = index">
        <th>AddCol{{ k + 1 }}</th>
      </ng-container>
      <!--
        【Input 2列 + Select 1列 のパターン列の追加・削除方法】
        1. ここで `[].constructor(6)` の `6` を変更することで、このパターンの繰り返し回数を調整できます。
           例: 3回に減らす場合 `[].constructor(3)` (Input 6列 + Select 3列)
           例: 8回に増やす場合 `[].constructor(8)` (Input 16列 + Select 8列)
        2. `home.component.ts` の `NUM_COLUMNS` と `STATUS_COLUMN_INDEX` 定数も、この変更に合わせて再計算し、更新する必要があります。
           `NUM_COLUMNS` = 1 (Index) + `ADDED_COLUMNS_COUNT` + (変更後の繰り返し回数 * 3) + 1 (Status)
           `STATUS_COLUMN_INDEX` = `NUM_COLUMNS` - 1
        3. `home.component.scss` の `th:nth-child()` と `td:nth-child()` セレクタも調整が必要です。
           特に、Input列とSelect列のCSSセレクタの範囲を、変更後の列数に合わせて更新してください。
      -->
      <ng-container *ngFor="let col of [].constructor(6); let k = index">
        <th>I{{ k * 2 + 1 }}</th>
        <th>I{{ k * 2 + 2 }}</th>
        <th>S{{ k + 1 }}</th>
      </ng-container>
      <!--
        【Status列について】
        この列はテーブルの最終列として固定されています。
        この列を削除する場合は、`home.component.ts` の `STATUS_COLUMN_INDEX` 定数と、
        `NUM_COLUMNS` 定数の計算からこの列の分を減らす必要があります。
        また、関連するロジック (`isChanged`, `onStatusChange`, `finalConfirm` など) も調整が必要になる場合があります。
      -->
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    <tr
      *ngFor="let item of items; let i = index"
      (click)="onRowClick(i)"
      [class.selected-row]="selectedRowIndex === i"
    >
      <td
        #dataCell
        [class.selected-cell]="selectedCell.row === i && selectedCell.col === 0"
      >
        {{ i + 1 }}
      </td>
      <!--
        【列の追加・削除方法】
        1. ここで `[].constructor(10)` の `10` を変更することで、追加列の数を調整できます。
           例: 5列に減らす場合 `[].constructor(5)`
           例: 15列に増やす場合 `[].constructor(15)`
        2. `home.component.ts` の `ADDED_COLUMNS_COUNT` 定数も同じ値に変更してください。
        3. `home.component.scss` の `th:nth-child()` と `td:nth-child()` セレクタも調整が必要です。
           特に、追加列のCSSセレクタの範囲 (`th:nth-child(2)` から `th:nth-child(11)`) を変更後の列数に合わせて更新してください。
      -->
      <ng-container *ngFor="let col of [].constructor(10); let k = index">
        <td
          #dataCell
          [class.selected-cell]="
            selectedCell.row === i && selectedCell.col === k + 1
          "
        >
          {{ data[i]["Column " + (k + 1)] }}
        </td>
      </ng-container>
      <!--
        【Input 2列 + Select 1列 のパターン列の追加・削除方法】
        1. ここで `[].constructor(6)` の `6` を変更することで、このパターンの繰り返し回数を調整できます。
           例: 3回に減らす場合 `[].constructor(3)` (Input 6列 + Select 3列)
           例: 8回に増やす場合 `[].constructor(8)` (Input 16列 + Select 8列)
        2. `home.component.ts` の `NUM_COLUMNS` と `STATUS_COLUMN_INDEX` 定数も、この変更に合わせて再計算し、更新する必要があります。
           `NUM_COLUMNS` = 1 (Index) + `ADDED_COLUMNS_COUNT` + (変更後の繰り返し回数 * 3) + 1 (Status)
           `STATUS_COLUMN_INDEX` = `NUM_COLUMNS` - 1
        3. `home.component.scss` の `th:nth-child()` と `td:nth-child()` セレクタも調整が必要です。
           特に、Input列とSelect列のCSSセレクタの範囲を、変更後の列数に合わせて更新してください。
      -->
      <ng-container *ngFor="let col of [].constructor(6); let k = index">
        <!-- Input 1 -->
        <td
          #dataCell
          tabindex="0"
          (click)="onCellClick(i, ADDED_COLUMNS_COUNT + k * 3 + 1)"
          (dblclick)="startEditing(i, ADDED_COLUMNS_COUNT + k * 3 + 1)"
          [class.selected-cell]="
            selectedCell.row === i &&
            selectedCell.col === ADDED_COLUMNS_COUNT + k * 3 + 1
          "
        >
          <ng-container
            *ngIf="
              editingCell?.row === i &&
                editingCell?.col === ADDED_COLUMNS_COUNT + k * 3 + 1;
              else viewModeInput1
            "
          >
            <input
              [id]="'edit-input-' + i + '-' + (ADDED_COLUMNS_COUNT + k * 3 + 1)"
              [(ngModel)]="editedValue"
              (blur)="saveEditedValue()"
              (keydown.enter)="saveEditedValueAndMoveDown()"
              (keydown.escape)="cancelEditing()"
            />
          </ng-container>
          <ng-template #viewModeInput1>
            {{ data[i]["Column " + (ADDED_COLUMNS_COUNT + k * 3 + 1)] }}
          </ng-template>
        </td>
        <!-- Input 2 -->
        <td
          #dataCell
          tabindex="0"
          (click)="onCellClick(i, ADDED_COLUMNS_COUNT + k * 3 + 2)"
          (dblclick)="startEditing(i, ADDED_COLUMNS_COUNT + k * 3 + 2)"
          [class.selected-cell]="
            selectedCell.row === i &&
            selectedCell.col === ADDED_COLUMNS_COUNT + k * 3 + 2
          "
        >
          <ng-container
            *ngIf="
              editingCell?.row === i &&
                editingCell?.col === ADDED_COLUMNS_COUNT + k * 3 + 2;
              else viewModeInput2
            "
          >
            <input
              [id]="'edit-input-' + i + '-' + (ADDED_COLUMNS_COUNT + k * 3 + 2)"
              [(ngModel)]="editedValue"
              (blur)="saveEditedValue()"
              (keydown.enter)="saveEditedValueAndMoveDown()"
              (keydown.escape)="cancelEditing()"
            />
          </ng-container>
          <ng-template #viewModeInput2>
            {{ data[i]["Column " + (ADDED_COLUMNS_COUNT + k * 3 + 2)] }}
          </ng-template>
        </td>
        <!-- Select -->
        <td
          #dataCell
          tabindex="0"
          [class.changed]="isChanged(i, ADDED_COLUMNS_COUNT + k * 3 + 3)"
          [class.selected-for-confirmation]="selectedForConfirmation[i]"
          [class.confirmed-and-cleared]="isConfirmedAndCleared[i]"
          (click)="onCellClick(i, ADDED_COLUMNS_COUNT + k * 3 + 3)"
          [class.selected-cell]="
            selectedCell.row === i &&
            selectedCell.col === ADDED_COLUMNS_COUNT + k * 3 + 3
          "
        >
          <select
            #statusSelect
            [id]="'select-' + i + '-' + (ADDED_COLUMNS_COUNT + k * 3 + 3)"
            name="status-{{ i }}-{{ ADDED_COLUMNS_COUNT + k * 3 + 3 }}"
            [(ngModel)]="data[i]['Column ' + (ADDED_COLUMNS_COUNT + k * 3 + 3)]"
            (ngModelChange)="
              onStatusChange(i, ADDED_COLUMNS_COUNT + k * 3 + 3);
              moveSelection('ArrowDown')
            "
            [disabled]="isConfirmedAndCleared[i] || isConfirmationMode"
            (keydown)="onStatusSelectKeydown($event, i)"
          >
            <option value="">--</option>
            <option value="OK">OK</option>
            <option value="NG">NG</option>
          </select>
        </td>
      </ng-container>
      <!--
        【Status列について】
        この列はテーブルの最終列として固定されています。
        この列を削除する場合は、`home.component.ts` の `STATUS_COLUMN_INDEX` 定数と、
        `NUM_COLUMNS` 定数の計算からこの列の分を減らす必要があります。
        また、関連するロジック (`isChanged`, `onStatusChange`, `finalConfirm` など) も調整が必要になる場合があります。
      -->
      <td
        #dataCell
        tabindex="0"
        [class.changed]="isChanged(i, STATUS_COLUMN_INDEX)"
        [class.selected-for-confirmation]="selectedForConfirmation[i]"
        [class.confirmed-and-cleared]="isConfirmedAndCleared[i]"
        (click)="onCellClick(i, STATUS_COLUMN_INDEX)"
        [class.selected-cell]="
          selectedCell.row === i && selectedCell.col === STATUS_COLUMN_INDEX
        "
      >
        <select
          #statusSelect
          name="status-{{ i }}-final"
          [(ngModel)]="data[i]['Column ' + STATUS_COLUMN_INDEX]"
          (ngModelChange)="
            onStatusChange(i, STATUS_COLUMN_INDEX); moveSelection('ArrowDown')
          "
          [disabled]="isConfirmedAndCleared[i] || isConfirmationMode"
          (keydown)="onStatusSelectKeydown($event, i)"
        >
          <option value="">--</option>
          <option value="OK">OK</option>
          <option value="NG">NG</option>
        </select>
      </td>
    </tr>
  </tbody>
</table>

<div>
  <label>
    <input type="checkbox" [(ngModel)]="isConfirmationMode" />
    確認モード
  </label>
</div>

<button (click)="finalConfirm()" [disabled]="!isConfirmationMode">
  最終確認
</button>
